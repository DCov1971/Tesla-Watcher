name: Tesla Watcher

on:
schedule:
- cron: "*/10 * * * *"
workflow_dispatch:

jobs:
run-script:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4

  - name: Setup Python
    uses: actions/setup-python@v5
    with:
      python-version: "3.11"

  - name: Install dependencies
    run: pip install requests

  - name: Restore state cache
    uses: actions/cache@v4
    with:
      path: state
      key: tesla-watcher-state

  - name: Run watcher
    env:
      PUSHOVER_USER: ${{ secrets.PUSHOVER_USER }}
      PUSHOVER_TOKEN: ${{ secrets.PUSHOVER_TOKEN }}
    run: python watcher.py

  - name: Save state cache
    uses: actions/cache@v4
    with:
      path: state
      key: tesla-watcher-state
